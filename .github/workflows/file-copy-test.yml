name: 1. Adım - Dosya Kopyalama Testi

on:
  workflow_dispatch: # Manuel tetikleme

jobs:
  deploy-files-only:
    runs-on: self-hosted # Senin bilgisayarındaki siyah ekran (Runner) çalışacak

    steps:
    # 1. Kodu GitHub'dan çek
    - name: Kodu Getir
      uses: actions/checkout@v4

    # 2. Projeyi Derle (PATH DÜZELTİLDİ: Restoran.Web klasörüne bakacak)
    - name: Build ve Publish
      run: dotnet publish ./Restoran.Web/Restoran.Web.csproj -c Release -o ./publish-output

    # 3. Dosyaları Masaüstündeki Klasöre Taşı (Robocopy)
    - name: Dosyaları Kopyala (Hariç Tutma Ayarlı)
      run: |
        echo "Kopyalama işlemi başlıyor..."
        
        # Hedef klasör yoksa oluştur
        if not exist "C:\Users\Yunus\Desktop\testpublish" mkdir "C:\Users\Yunus\Desktop\testpublish"

        # ROBOCOPY KOMUTU:
        # /E  : Alt klasörler dahil
        # /XF : appsettings.json ve web.config dosyalarını EZME (Hariç tut)
        # /XD : uploads klasörünü EZME (Hariç tut)
        
        robocopy "./publish-output" "C:\Users\Yunus\Desktop\testpublish" /E /XF appsettings.json web.config /XD uploads

        # Robocopy başarılı olunca 1 kodu döner, hata sanmasın diye 0 yapıyoruz.
        if %ERRORLEVEL% LEQ 1 exit 0 else exit %ERRORLEVEL%
      shell: cmd